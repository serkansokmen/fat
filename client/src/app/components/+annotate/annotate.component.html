<fat-annotate-steps
  *ngIf="(annotate$ | async)?.selectedImage"
  [selectedImage]="(annotate$ | async)?.selectedImage"
  [items]="(annotate$ | async)?.steps"
  [step]="(annotate$ | async)?.selectedStep"
  (onStepSelect)="handleStepChange($event)"
  (onNext)="handleNext($event)"></fat-annotate-steps>

<md-card>
  <md-card-title *ngIf="(annotate$ | async)?.images[0] && !(annotate$ | async)?.isRequesting">
    <h1 [innerHTML]="(annotate$ | async)?.stepTitle"></h1>
    <p [innerHTML]="(annotate$ | async)?.stepDescription"></p>
  </md-card-title>
  <md-card-content>

    <md-progress-spinner *ngIf="(annotate$ | async)?.isRequesting" color="primary" mode="indeterminate"></md-progress-spinner>

    <div class="jumbotron" *ngIf="!(annotate$ | async)?.images[0] && !(annotate$ | async)?.isRequesting">
      <div class="container">
        <h2>No approved images yet.</h2>
        <p>Collected images will appear here as soon as they are approved by the moderators.</p>
        <p>If you are a moderator, you can <a [href]="adminURL" target="_blank">login</a> to the admin panel and approve collected images.</p>
      </div>
    </div>

    <div class="content" *ngIf="(annotate$ | async)?.images[0] && !(annotate$ | async)?.isRequesting">

      <div *ngIf="!(annotate$ | async)?.selectedImage && !(annotate$ | async)?.selectedStep">
        <div *ngIf="(annotate$ | async)?.previous">
          <button md-button>{{ (annotate$ | async)?.previous }}</button>
        </div>
        <div *ngIf="(annotate$ | async)?.previous">
          <button md-button>{{ (annotate$ | async)?.previous }}</button>
        </div>
        <fat-card-list
            [images]="(annotate$ | async)?.images"
            [cardOptions]="viewMode"
            (onCardClick)="handleCardSelect($event)"></fat-card-list>
      </div>

      <div [ngSwitch]="(annotate$ | async)?.selectedStep">

        <fat-skin-pixels-regions *ngSwitchCase="1" [image]="(annotate$ | async)?.selectedImage"
          (annotated)="handleImageAnnotated($event)"></fat-skin-pixels-regions>
        <fat-nudity-check *ngSwitchCase="2" [image]="(annotate$ | async)?.selectedImage"></fat-nudity-check>
        <fat-object-x *ngSwitchCase="3" [image]="(annotate$ | async)?.selectedImage"></fat-object-x>
        <fat-attributes *ngSwitchCase="4" [image]="(annotate$ | async)?.selectedImage"></fat-attributes>

        <!-- <img [src]="(annotate$ | async)?.annotatedImage"> -->

      </div>
    </div>

    <pre [innerHTML]="(annotate$ | async)?.annotatedImage | json"></pre>

  </md-card-content>
</md-card>
